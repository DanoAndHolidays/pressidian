# ArrayBufferã€TypedArray ä¸ DataView è¯¦è§£
---
##### ArrayBuffer - åŸå§‹äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒº
[è¡¥å……è¯´æ˜]ï¼šArrayBuffer è¡¨ç¤ºé€šç”¨çš„ã€å›ºå®šé•¿åº¦çš„åŸå§‹äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒºã€‚
```javascript
// åˆ›å»º ArrayBuffer [ä¿®æ­£æœ¯è¯­ï¼šArraybuffer â†’ ArrayBuffer]
const buffer = new ArrayBuffer(16); // åˆ›å»º16å­—èŠ‚çš„ç¼“å†²åŒº
console.log(buffer.byteLength);    // 16

// ä¸èƒ½ç›´æ¥æ“ä½œ ArrayBufferï¼Œéœ€è¦é€šè¿‡è§†å›¾æ“ä½œ
// console.log(buffer[0]); // é”™è¯¯ï¼šä¸èƒ½ç›´æ¥è®¿é—®
```
##### TypedArray - ç±»å‹åŒ–æ•°ç»„è§†å›¾
[è¡¥å……è¯´æ˜]ï¼šTypedArray æä¾›äº†å¯¹ ArrayBuffer çš„ç±»å‹åŒ–è§†å›¾è®¿é—®ã€‚
åœ¨ JavaScript ä¸­ï¼Œ**TypedArrayï¼ˆç±»å‹åŒ–æ•°ç»„ï¼‰** æ˜¯ä¸€ç»„ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„æ•°ç»„-likeå¯¹è±¡ï¼Œä¸“ä¸ºé«˜æ•ˆæ“ä½œåŸå§‹äºŒè¿›åˆ¶æ•°æ®è€Œè®¾è®¡ã€‚å®ƒä»¬ä¸æ™®é€šæ•°ç»„ï¼ˆ`Array`ï¼‰çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼š**å­˜å‚¨çš„æ•°æ®ç±»å‹å›ºå®š**ï¼ˆå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ç­‰ï¼‰ï¼Œä¸”**é•¿åº¦ä¸å¯å˜**ï¼Œå› æ­¤æ€§èƒ½æ›´é«˜ï¼Œå°¤å…¶é€‚åˆå¤„ç†å¤§é‡äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚éŸ³é¢‘ã€å›¾åƒã€ç½‘ç»œåè®®æ•°æ®ç­‰ï¼‰ã€‚
##### TypedArray çš„ç‰¹ç‚¹
1. **å›ºå®šæ•°æ®ç±»å‹**ï¼šæ¯ä¸ªå…ƒç´ çš„ç±»å‹åœ¨åˆ›å»ºæ—¶ç¡®å®šï¼ˆå¦‚ 8ä½æ•´æ•°ã€32ä½æµ®ç‚¹æ•°ç­‰ï¼‰ï¼Œé¿å…äº†æ™®é€šæ•°ç»„çš„åŠ¨æ€ç±»å‹è½¬æ¢å¼€é”€ã€‚  
2. **å›ºå®šé•¿åº¦**ï¼šåˆ›å»ºæ—¶éœ€æŒ‡å®šé•¿åº¦ï¼Œåˆ›å»ºåæ— æ³•é€šè¿‡ `push`/`pop` ç­‰æ–¹æ³•æ”¹å˜ï¼ˆç±»ä¼¼ C è¯­è¨€çš„æ•°ç»„ï¼‰ã€‚  
3. **å­˜å‚¨åŸå§‹äºŒè¿›åˆ¶æ•°æ®**ï¼šç›´æ¥æ˜ å°„åˆ°å†…å­˜ä¸­çš„äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒºï¼ˆ`ArrayBuffer`ï¼‰ï¼Œè¯»å†™æ•ˆç‡è¿œé«˜äºæ™®é€šæ•°ç»„ã€‚  
4. **ä¸ç»§æ‰¿ `Array.prototype`**ï¼šä¸æ”¯æŒ `Array` çš„éƒ¨åˆ†æ–¹æ³•ï¼ˆå¦‚ `concat`ã€`splice`ï¼‰ï¼Œä½†æ”¯æŒç´¢å¼•è®¿é—®å’Œ `length` å±æ€§ã€‚  
##### å¸¸è§çš„ TypedArray ç±»å‹
JavaScript æä¾›äº†å¤šç§ TypedArray æ„é€ å‡½æ•°ï¼Œå¯¹åº”ä¸åŒçš„æ•°æ®ç±»å‹å’Œå­—èŠ‚é•¿åº¦ï¼š

| æ„é€ å‡½æ•°          | å…ƒç´ ç±»å‹               | å­—èŠ‚é•¿åº¦ | å–å€¼èŒƒå›´ï¼ˆç¤ºä¾‹ï¼‰                  |
|-------------------|------------------------|----------|-----------------------------------|
| `Int8Array`       | 8ä½æœ‰ç¬¦å·æ•´æ•°          | 1        | -128 åˆ° 127                       |
| `Uint8Array`      | 8ä½æ— ç¬¦å·æ•´æ•°          | 1        | 0 åˆ° 255                          |
| `Uint8ClampedArray`| 8ä½æ— ç¬¦å·æ•´æ•°ï¼ˆæˆªæ–­ï¼‰  | 1        | è¶…å‡ºèŒƒå›´æ—¶è‡ªåŠ¨æˆªæ–­ä¸º 0 æˆ– 255      |
| `Int16Array`      | 16ä½æœ‰ç¬¦å·æ•´æ•°         | 2        | -32768 åˆ° 32767                   |
| `Uint16Array`     | 16ä½æ— ç¬¦å·æ•´æ•°         | 2        | 0 åˆ° 65535                        |
| `Int32Array`      | 32ä½æœ‰ç¬¦å·æ•´æ•°         | 4        | -2Â³Â¹ åˆ° 2Â³Â¹-1                     |
| `Uint32Array`     | 32ä½æ— ç¬¦å·æ•´æ•°         | 4        | 0 åˆ° 2Â³Â²-1                        |
| `Float32Array`    | 32ä½æµ®ç‚¹æ•°ï¼ˆå•ç²¾åº¦ï¼‰   | 4        | çº¦ Â±3.4Ã—10Â³â¸                      |
| `Float64Array`    | 64ä½æµ®ç‚¹æ•°ï¼ˆåŒç²¾åº¦ï¼‰   | 8        | çº¦ Â±1.8Ã—10Â³â°â¸                     |

**TypedArray çš„ä½¿ç”¨ç¤ºä¾‹**
TypedArray å¿…é¡»åŸºäº ArrayBufferï¼ˆåŸå§‹äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒºï¼‰åˆ›å»ºï¼Œç›´æ¥åˆ›å»ºä¼šåœ¨å†…éƒ¨è‡ªåŠ¨åˆ›å»ºï¼Œ`ArrayBuffer` æ˜¯ä¸€å—åŸå§‹çš„å†…å­˜åŒºåŸŸï¼ŒTypedArray åˆ™æ˜¯å¯¹è¿™å—å†…å­˜çš„â€œè§†å›¾â€ï¼ˆæŒ‰æŒ‡å®šç±»å‹è§£ææ•°æ®ï¼‰ã€‚
##### 1. åŸºæœ¬åˆ›å»ºä¸ä½¿ç”¨
```javascript
// 1. åˆ›å»ºä¸€ä¸ª 16 å­—èŠ‚çš„ ArrayBufferï¼ˆå†…å­˜ç¼“å†²åŒºï¼‰
const buffer = new ArrayBuffer(16);

// 2. åˆ›å»º TypedArray è§†å›¾ï¼ˆä»¥ 32ä½æ•´æ•°è§£æ bufferï¼‰
const int32View = new Int32Array(buffer);

// 3. é•¿åº¦ç”±ç¼“å†²åŒºå¤§å°å’Œå…ƒç´ å­—èŠ‚é•¿åº¦å†³å®šï¼š16å­—èŠ‚ / 4å­—èŠ‚/å…ƒç´  = 4ä¸ªå…ƒç´ 
console.log(int32View.length); // 4

// 4. æ“ä½œå…ƒç´ ï¼ˆç´¢å¼•è®¿é—®ï¼‰
int32View[0] = 100;
int32View[1] = 200;
console.log(int32View); // Int32Array(4) [100, 200, 0, 0]
// æŸ¥çœ‹å¯¹åº”çš„åŸå§‹äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒº
// ArrayBuffer {
//   [Uint8Contents]: <64 00 00 00 c8 00 00 00 00 00 00 00 00 00 00 00>,
//   byteLength: 16
// }

// 5. ä¸åŒè§†å›¾è§£æåŒä¸€å—ç¼“å†²åŒºï¼ˆäºŒè¿›åˆ¶æ•°æ®çš„çµæ´»è§£è¯»ï¼‰
const uint8View = new Uint8Array(buffer);
console.log(uint8View); // Uint8Array(16) [100, 0, 0, 0, 200, 0, 0, 0, 0, ...]
```
64 00 00 00 c8 00 00 00 00 00 00 00 00 00 00 00
ä½ä½â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”é«˜ä½
å¯¹åº”16ä¸ªå­—èŠ‚ï¼Œint32æ˜¯ç”¨32ä¸ªä½ï¼Œå°±æ˜¯4ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯å››ä¸ªä¸€ç»„ï¼Œè½¬æ¢ä¸º10è¿›åˆ¶ï¼š
å¯¹åº”100,200,0,0
##### 2. ç›´æ¥åˆå§‹åŒ–
ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡é•¿åº¦æˆ–æ•°ç»„åˆå§‹åŒ– TypedArrayï¼ˆå†…éƒ¨ä¼šå¯¹åº”çš„==è‡ªåŠ¨åˆ›å»º== ==`ArrayBuffer`==ï¼‰ï¼š
```javascript
// ç”¨é•¿åº¦åˆå§‹åŒ–ï¼ˆ8ä¸ª 16ä½æ•´æ•°ï¼‰
const int16Arr = new Int16Array(8)
int16Arr[0] = 32767 // æœ€å¤§16ä½æœ‰ç¬¦å·æ•´æ•°
console.log(int16Arr.buffer);
// ArrayBuffer {
//   [Uint8Contents]: <ff 7f 00 00 00 00 00 00 00 00 00 00 00 00 00 00>,
//   byteLength: 16
// }

// ç”¨æ•°ç»„åˆå§‹åŒ–
const float64Arr = new Float64Array([1.5, 2.5, 3.5])
console.log(float64Arr[1]) // 2.5
console.log(float64Arr.buffer)
// ArrayBuffer {
//   [Uint8Contents]: <00 00 00 00 00 00 f8 3f 00 00 00 00 00 00 04 40 00 00 00 00 00 00 0c 40>,
//   byteLength: 24
// }
```
##### TypedArray ä¸æ™®é€šæ•°ç»„çš„æ ¸å¿ƒåŒºåˆ«

| ç‰¹æ€§               | TypedArray                  | æ™®é€šæ•°ç»„ï¼ˆ`Array`ï¼‰            |
|--------------------|-----------------------------|--------------------------------|
| å…ƒç´ ç±»å‹           | å›ºå®šï¼ˆå¦‚ `Int32`ã€`Float64`ï¼‰| åŠ¨æ€ï¼ˆå¯æ··åˆå„ç§ç±»å‹ï¼‰          |
| é•¿åº¦               | å›ºå®šï¼ˆåˆ›å»ºåä¸å¯å˜ï¼‰         | å¯å˜ï¼ˆå¯é€šè¿‡ `push` ç­‰æ–¹æ³•ä¿®æ”¹ï¼‰|
| å­˜å‚¨æ–¹å¼           | äºŒè¿›åˆ¶ç¼“å†²åŒºï¼ˆé«˜æ•ˆï¼‰         | åŠ¨æ€å¯¹è±¡å­˜å‚¨ï¼ˆæœ‰é¢å¤–å¼€é”€ï¼‰      |
| ç»§æ‰¿å…³ç³»           | ä¸ç»§æ‰¿ `Array.prototype`    | ç»§æ‰¿ `Array.prototype`         |
| é€‚ç”¨åœºæ™¯           | äºŒè¿›åˆ¶æ•°æ®å¤„ç†ï¼ˆéŸ³è§†é¢‘ç­‰ï¼‰   | é€šç”¨æ•°æ®å­˜å‚¨ä¸æ“ä½œ              |

```javascript
// ä¸åŒç±»å‹çš„ TypedArray è§†å›¾
const int8Array = new Int8Array(buffer);      // 8ä½æœ‰ç¬¦å·æ•´æ•°
const uint8Array = new Uint8Array(buffer);    // 8ä½æ— ç¬¦å·æ•´æ•°
const int16Array = new Int16Array(buffer);    // 16ä½æœ‰ç¬¦å·æ•´æ•°
const uint16Array = new Uint16Array(buffer);  // 16ä½æ— ç¬¦å·æ•´æ•°
const int32Array = new Int32Array(buffer);    // 32ä½æœ‰ç¬¦å·æ•´æ•°
const uint32Array = new Uint32Array(buffer);  // 32ä½æ— ç¬¦å·æ•´æ•°
const float32Array = new Float32Array(buffer); // 32ä½æµ®ç‚¹æ•°
const float64Array = new Float64Array(buffer); // 64ä½æµ®ç‚¹æ•°

// ç›´æ¥åˆ›å»ºå¸¦æ•°æ®çš„ TypedArray
const dataArray = new Uint8Array([1, 2, 3, 4, 5]);
console.log(dataArray.length);    // 5
console.log(dataArray.byteLength); // 5
```
##### DataView - çµæ´»çš„æ•°æ®è®¿é—®è§†å›¾
[è¡¥å……è¯´æ˜]ï¼šDataView æä¾›äº†æ›´çµæ´»çš„ä½çº§æ¥å£æ¥è¯»å†™ ArrayBuffer ä¸­çš„æ•°æ®ã€‚
```javascript
// åˆ›å»º DataView
const buffer = new ArrayBuffer(4)
const view = new DataView(buffer)


// è®¾ç½®å’Œè¯»å–æ•°æ®ï¼ˆå¯ä»¥æŒ‡å®šå­—èŠ‚åç§»å’Œç«¯åºï¼‰
view.setInt8(0, 127) // åœ¨ä½ç½®0å†™å…¥8ä½æœ‰ç¬¦å·æ•´æ•°
console.log(view.buffer)
// ArrayBuffer { [Uint8Contents]: <7f 00 00 00>, byteLength: 4 }

// å°ç«¯åºå†™å…¥16ä½æ— ç¬¦å·æ•´æ•°
view.setUint16(2, 65534, true) 
console.log(view.buffer);
// ArrayBuffer { [Uint8Contents]: <7f 00 fe ff>, byteLength: 4 }


console.log(view.getInt8(0))
// 127 å› ä¸ºå°±ä¸€ä½æ‰€ä»¥ä¸åˆ†é«˜ä½äº†

console.log(view.getUint16(2, true))
// 65534 (å°ç«¯åºè¯»å–)ä»ä½ä½ï¼ˆfeï¼‰åˆ°é«˜ä½ï¼ˆffï¼‰

console.log(view.getUint16(2))
// 65279 (å¤§ç«¯åºè¯»å–)åä¹‹

```
##### å†…å­˜å¸ƒå±€ä¸å­—èŠ‚åº
[è¡¥å……è¯´æ˜]ï¼šç†è§£å†…å­˜å¸ƒå±€å¯¹äºäºŒè¿›åˆ¶æ•°æ®å¤„ç†è‡³å…³é‡è¦ã€‚
```javascript
// æ¼”ç¤ºå­—èŠ‚åºï¼ˆEndiannessï¼‰çš„å½±å“
const testBuffer = new ArrayBuffer(4);
const view1 = new DataView(testBuffer);

// å†™å…¥32ä½æ•´æ•°
view1.setInt32(0, 0x12345678, false); // å¤§ç«¯åº
console.log(new Uint8Array(testBuffer)); // [0x12, 0x34, 0x56, 0x78]

view1.setInt32(0, 0x12345678, true);  // å°ç«¯åº
console.log(new Uint8Array(testBuffer)); // [0x78, 0x56, 0x34, 0x12]
```
##### ==å®é™…åº”ç”¨ç¤ºä¾‹==
```javascript
// ç¤ºä¾‹ï¼šå¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼ï¼ˆå¦‚å›¾åƒæ–‡ä»¶å¤´ï¼‰
function parsePNGHeader(buffer) {
    const view = new DataView(buffer);
    
    // æ£€æŸ¥PNGæ–‡ä»¶ç­¾å
    const signature = view.getUint32(0, false);
    if (signature !== 0x89504E47) {
        throw new Error('ä¸æ˜¯æœ‰æ•ˆçš„PNGæ–‡ä»¶');
    }
    
    // è¯»å–å›¾åƒå°ºå¯¸
    const width = view.getUint32(16, false);
    const height = view.getUint32(20, false);
    
    return { width, height };
}

// ç¤ºä¾‹ï¼šåˆ›å»ºå’Œæ“ä½œäºŒè¿›åˆ¶æ•°æ®
function createBinaryData() {
    const buffer = new ArrayBuffer(12);
    const view = new DataView(buffer);
    
    // å†™å…¥ä¸åŒç±»å‹çš„æ•°æ®
    view.setFloat32(0, Math.PI, true);    // 32ä½æµ®ç‚¹æ•°ï¼ˆå°ç«¯åºï¼‰
    view.setUint16(4, 1000, false);       // 16ä½æ— ç¬¦å·æ•´æ•°ï¼ˆå¤§ç«¯åºï¼‰
    view.setInt8(6, -50);                 // 8ä½æœ‰ç¬¦å·æ•´æ•°
    
    return buffer;
}
```
##### æ€§èƒ½ä¼˜åŒ–ä¸ä½¿ç”¨åœºæ™¯

| æ•°æ®ç±»å‹            | é€‚ç”¨åœºæ™¯      | ä¼˜ç‚¹        | ç¼ºç‚¹     |
| --------------- | --------- | --------- | ------ |
| **ArrayBuffer** | åŸå§‹äºŒè¿›åˆ¶æ•°æ®å­˜å‚¨ | å†…å­˜é«˜æ•ˆ      | ä¸èƒ½ç›´æ¥æ“ä½œ |
| **TypedArray**  | ç±»å‹åŒ–æ•°æ®å¤„ç†   | é«˜æ€§èƒ½ï¼Œç±»å‹å®‰å…¨  | å›ºå®šæ•°æ®ç±»å‹ |
| **DataView**    | æ··åˆæ•°æ®ç±»å‹è®¿é—®  | çµæ´»ï¼Œæ”¯æŒç«¯åºæ§åˆ¶ | æ€§èƒ½ç¨ä½   |

```javascript
// æ€§èƒ½æ¯”è¾ƒï¼šTypedArray vs DataView
const testData = new ArrayBuffer(1000000);

// ä½¿ç”¨ TypedArrayï¼ˆæ›´å¿«ï¼‰
console.time('TypedArray');
const uint8View = new Uint8Array(testData);
for (let i = 0; i < uint8View.length; i++) {
    uint8View[i] = i % 256;
}
console.timeEnd('TypedArray');

// ä½¿ç”¨ DataViewï¼ˆæ›´çµæ´»ä½†ç¨æ…¢ï¼‰
console.time('DataView');
const dataView = new DataView(testData);
for (let i = 0; i < testData.byteLength; i++) {
    dataView.setUint8(i, i % 256);
}
console.timeEnd('DataView');
```

##### ä¸ Blob çš„è½¬æ¢
```javascript
// ArrayBuffer è½¬ Blob
const arrayBuffer = new ArrayBuffer(1024);
const blob = new Blob([arrayBuffer], {type: 'application/octet-stream'});

// Blob è½¬ ArrayBuffer
async function blobToArrayBuffer(blob) {
    return await blob.arrayBuffer(); // ç°ä»£æµè§ˆå™¨æ”¯æŒçš„æ–¹æ³•
    // æˆ–ä½¿ç”¨ FileReader
    // return new Promise((resolve) => {
    //     const reader = new FileReader();
    //     reader.onloadend = () => resolve(reader.result);
    //     reader.readAsArrayBuffer(blob);
    // });
}
```

---
# Blobã€File ä¸ Object URL è¯¦è§£
---

##### Blob å¯¹è±¡
[è¡¥å……è¯´æ˜]ï¼šBlobï¼ˆBinary Large Objectï¼‰è¡¨ç¤ºä¸å¯å˜çš„åŸå§‹æ•°æ®ç±»æ–‡ä»¶å¯¹è±¡ã€‚
```javascript
// åˆ›å»º Blob å¯¹è±¡
let debug = { name: 'Dano' }
let str = JSON.stringify(debug)
console.log(str)
// {"name":"Dano"} 15ä¸ªå­—ç¬¦

// è¯­æ³•ï¼šnew Blob(array, options)
let blob = new Blob([str], { type: 'application/json' })

// è·å– Blob ä¿¡æ¯
console.log(blob) // Blob { size: 15, type: 'application/json' }
console.log(blob.size) // Blob å¤§å°ï¼ˆå­—èŠ‚ï¼‰15
console.log(blob.type) // MIME ç±»å‹ application/json

```
åœ¨JavaScriptä¸­ï¼Œå­—ç¬¦çš„å­˜å‚¨æ–¹å¼å–å†³äºå­—ç¬¦ä¸²çš„ç¼–ç ç±»å‹ã€‚JavaScriptå­—ç¬¦ä¸²ä½¿ç”¨UTF-16ç¼–ç ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªå­—ç¬¦é€šå¸¸ä½¿ç”¨==2ä¸ªå­—èŠ‚==ï¼ˆ16ä½ï¼‰å­˜å‚¨ã€‚ä½†æ˜¯ï¼Œå¯¹äºUnicodeä¸­è¶…å‡ºåŸºæœ¬å¤šæ–‡ç§å¹³é¢ï¼ˆBMPï¼‰çš„å­—ç¬¦ï¼ˆå³ç ç‚¹å¤§äº0xFFFFçš„å­—ç¬¦ï¼‰ï¼Œå®ƒä»¬éœ€è¦ä½¿ç”¨ä¸¤ä¸ª16ä½ç å…ƒï¼ˆå³==4ä¸ªå­—èŠ‚==ï¼‰æ¥è¡¨ç¤ºï¼Œè¿™ç§°ä¸ºä»£ç†å¯¹ï¼ˆsurrogate pairï¼‰ã€‚

å› æ­¤ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå­—ç¬¦å ç”¨2ä¸ªå­—èŠ‚ï¼Œä½†å¯¹äºè¾…åŠ©å¹³é¢ä¸­çš„å­—ç¬¦ï¼Œåˆ™å ç”¨4ä¸ªå­—èŠ‚ã€‚
```JavaScript
// åˆ›å»º Blob å¯¹è±¡
let debug = { name: 'DanoğŸ˜Š' }
let str = JSON.stringify(debug)
console.log(str)

let blob = new Blob([str], { type: 'application/json' })

// è·å– Blob ä¿¡æ¯
console.log(blob) 
console.log(blob.size) 
console.log(blob.type) 
// {"name":"DanoğŸ˜Š"}
// Blob { size: 19, type: 'application/json' }
// 19
// application/json
```
##### File å¯¹è±¡
[è¡¥å……è¯´æ˜]ï¼šFile å¯¹è±¡ç»§æ‰¿è‡ª Blobï¼Œè¡¨ç¤ºæ–‡ä»¶æ•°æ®ã€‚
```javascript
// é€šè¿‡ input è·å– File å¯¹è±¡
const fileInput = document.getElementById('fileInput');
fileInput.addEventListener('change', (event) => {
    const file = event.target.files[0];
    console.log(file.name);    // æ–‡ä»¶å
    console.log(file.size);    // æ–‡ä»¶å¤§å°
    console.log(file.type);    // æ–‡ä»¶ç±»å‹
    console.log(file.lastModified); // æœ€åä¿®æ”¹æ—¶é—´
});

// åˆ›å»º File å¯¹è±¡
const file = new File([JSON.stringify(debug)], 'user.json', {
    type: 'application/json',
    lastModified: Date.now()
});
```
##### FileReader è¯»å–æ–‡ä»¶å†…å®¹
[ä¿®æ­£ä»£ç ]ï¼šFileReaderæ˜¯æµè§ˆå™¨ç‹¬æœ‰çš„APIåœ¨Nodeä¸­
```javascript
let json = { name: 'DanoğŸ˜Š' }

const file = new File([JSON.stringify(json)], 'user.json', {
    type: 'application/json',
    lastModified: Date.now(),
})

console.log(file)
// File {
//   size: 19,
//   type: 'application/json',
//   name: 'user.json',
//   lastModified: 1757595534532
// }

let reader = new FileReader()
reader.readAsArrayBuffer(file)

reader.onload = function (e) {
    const arrayBuffer = e.target.result
    // å°† ArrayBuffer è½¬æ¢ä¸ºå­—ç¬¦ä¸²
    const decoder = new TextDecoder('utf-8')
    const jsonString = decoder.decode(arrayBuffer)
    const parsedJson = JSON.parse(jsonString)

    // æ˜¾ç¤ºç»“æœ
    console.log(file, arrayBuffer, parsedJson)
}

reader.onerror = function (e) {
    console.error('è¯»å–æ–‡ä»¶æ—¶å‡ºé”™: ', e.target.error)
}
```
![[Pasted image 20250911211549.png]]
##### Object URL
[è¡¥å……è¯´æ˜]ï¼šåˆ›å»ºæŒ‡å‘Blob/Fileå¯¹è±¡çš„ä¸´æ—¶URL
```javascript
function download() {
    let debug = {name: 'Domo'};
    let blob = new Blob([JSON.stringify(debug)], {type: 'application/json'});
    
    // åˆ›å»ºä¸‹è½½é“¾æ¥
    let a = document.createElement('a');
    a.download = 'user.json';
    a.rel = 'noopener'; // å®‰å…¨ä¼˜åŒ–
    a.href = URL.createObjectURL(blob);
    
    // æ¨¡æ‹Ÿç‚¹å‡»ä¸‹è½½
    a.click();
    
    // é‡Šæ”¾URLèµ„æº [è¡¥å……è¯´æ˜]
    URL.revokeObjectURL(a.href);
}
```

##### Base64 ä¸ DataURL
[è¡¥å……è¯´æ˜]ï¼š
```javascript
// Data URL æ ¼å¼ï¼šdata:[<mediatype>][;base64],<data>
const dataURL = 'data:application/json;base64,eyJuYW1lIjoiRG9tbyJ9';

// Base64 ç¼–ç è§£ç 
const base64Encoded = btoa('Hello World'); // ç¼–ç 
const base64Decoded = atob('SGVsbG8gV29ybGQ='); // è§£ç 

// Blob è½¬ Base64
function blobToBase64(blob) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.readAsDataURL(blob);
    });
}
```
**Base64 å’Œ Data URL ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚** å®ƒä»¬çš„å…³ç³»éå¸¸å¯†åˆ‡ï¼Œä½†æ‰®æ¼”ç€å®Œå…¨ä¸åŒçš„è§’è‰²ã€‚
ç®€å•æ¥è¯´ï¼š
- **Base64 æ˜¯ä¸€ç§ç¼–ç æ–¹å¼**ï¼ˆæŠŠäºŒè¿›åˆ¶æ•°æ®å˜æˆæ–‡æœ¬ï¼‰ã€‚
- **Data URL æ˜¯ä¸€ç§ URL æ–¹æ¡ˆ**ï¼ˆä¸€ç§ç‰¹æ®Šæ ¼å¼çš„ç½‘å€ï¼‰ã€‚
- **Data URL ç»å¸¸ä½¿ç”¨ Base64 ç¼–ç ä½œä¸ºå…¶æ•°æ®éƒ¨åˆ†**ã€‚

##### Data URL
- **æ˜¯ä»€ä¹ˆ**ï¼šä¸€ç§ç‰¹æ®Šæ ¼å¼çš„URLï¼ˆç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰ï¼Œå®ƒçš„åè®®å¤´ä¸æ˜¯ `http:` æˆ– `https:`ï¼Œè€Œæ˜¯ `data:`ã€‚å®ƒå…è®¸å°†æ•°æ®ç›´æ¥å†…åµŒåœ¨æ–‡æ¡£ä¸­ï¼Œè€Œæ— éœ€ä»å¤–éƒ¨æœåŠ¡å™¨åŠ è½½ã€‚
- **ç»“æ„**ï¼šä¸€ä¸ªå®Œæ•´çš„Data URLæœ‰å›ºå®šçš„æ ¼å¼ï¼Œå®ƒåŒ…å«äº†**å…ƒæ•°æ®**å’Œ**æ•°æ®æœ¬èº«**ã€‚
`data:[<mediatype>][;base64],<data>`
- **`data:`**ï¼šåè®®å¤´ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªData URLã€‚
- **`[<mediatype>]`**ï¼šå¯é€‰çš„MIMEç±»å‹ï¼Œå‘Šè¯‰æµè§ˆå™¨æ•°æ®çš„æ ¼å¼æ˜¯ä»€ä¹ˆã€‚ä¾‹å¦‚ `image/png`, `text/css`, `application/pdf`ã€‚å¦‚æœçœç•¥ï¼Œé»˜è®¤ä¸º `text/plain`ã€‚
- **`[;base64]`**ï¼šå¯é€‰çš„æ ‡è¯†ç¬¦ã€‚å¦‚æœå­˜åœ¨ï¼Œè¡¨ç¤ºåé¢çš„ `<data>` éƒ¨åˆ†æ˜¯ç»è¿‡ **Base64ç¼–ç **çš„ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºæ•°æ®æ˜¯URLç¼–ç çš„æ–‡æœ¬ï¼ˆé€šå¸¸ä»…é€‚ç”¨äºçº¯æ–‡æœ¬æˆ–SVGï¼‰ã€‚
- **`,`**ï¼šåˆ†éš”ç¬¦ï¼Œå‰é¢æ˜¯å…ƒä¿¡æ¯ï¼Œåé¢æ˜¯æ•°æ®æœ¬ä½“ã€‚
- **`<data>`**ï¼šå®é™…çš„æ•°æ®å†…å®¹ã€‚å¦‚æœä½¿ç”¨äº† `;base64`ï¼Œè¿™é‡Œå°±æ˜¯Base64ç¼–ç åçš„å­—ç¬¦ä¸²ã€‚

ä¾‹å­ï¼š
ä¸€ä¸ªPNGå›¾ç‰‡çš„Data URLå¯èƒ½é•¿è¿™æ ·ï¼š
`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==`

##### å…³ç³»
- **ä¾èµ–å…³ç³»**ï¼šData URL **å¯ä»¥**ä½¿ç”¨Base64ç¼–ç ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ã€‚å¯¹äºäºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ã€PDFï¼‰ï¼Œå¿…é¡»ä½¿ç”¨Base64ç¼–ç æ‰èƒ½æ”¾å…¥Data URLã€‚å¯¹äºçº¯æ–‡æœ¬ï¼ˆå¦‚CSSæˆ–SVGä»£ç ï¼‰ï¼Œå¯ä»¥ä¸ä½¿ç”¨Base64ï¼Œç›´æ¥å†™å…¥ã€‚
- **åä½œæ–¹å¼**ï¼šData URL æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„â€œåŒ…è£…â€ï¼Œå‘Šè¯‰æµè§ˆå™¨â€œè¿™é‡Œé¢æ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®â€ä»¥åŠâ€œæ•°æ®æ˜¯å¦‚ä½•ç¼–ç çš„â€ã€‚è€ŒBase64ç¼–ç åˆ™è´Ÿè´£å®Œæˆå®é™…çš„æ•°æ®è½¬æ¢å·¥ä½œï¼Œå°†äºŒè¿›åˆ¶æ•°æ®å˜æˆData URLèƒ½å¤Ÿå®‰å…¨ä½¿ç”¨çš„æ–‡æœ¬å½¢å¼ã€‚
##### å†…å­˜ç®¡ç†æœ€ä½³å®è·µ
[è¡¥å……è¯´æ˜]ï¼š
1. **åŠæ—¶é‡Šæ”¾ Object URL**ï¼š
```javascript
const objectURL = URL.createObjectURL(blob);
// ä½¿ç”¨å®Œæˆåç«‹å³é‡Šæ”¾
URL.revokeObjectURL(objectURL);
```

2. **å¤§æ–‡ä»¶å¤„ç†**ï¼š
```javascript
// ä½¿ç”¨åˆ‡ç‰‡å¤„ç†å¤§æ–‡ä»¶
const chunkSize = 1024 * 1024; // 1MB
let offset = 0;

while (offset < file.size) {
    const chunk = file.slice(offset, offset + chunkSize);
    // å¤„ç†åˆ†ç‰‡...
    offset += chunkSize;
}
```

##### ä½¿ç”¨åœºæ™¯å¯¹æ¯”
| æŠ€æœ¯             | é€‚ç”¨åœºæ™¯      | ä¼˜ç‚¹         | ç¼ºç‚¹             |
| -------------- | --------- | ---------- | -------------- |
| **Object URL** | ä¸´æ—¶æ˜¾ç¤ºæˆ–ä¸‹è½½æ–‡ä»¶ | æ— éœ€æœåŠ¡å™¨ï¼Œæ€§èƒ½å¥½  | éœ€è¦æ‰‹åŠ¨é‡Šæ”¾å†…å­˜       |
| **Data URL**   | å°æ–‡ä»¶å†…è”     | è‡ªåŒ…å«ï¼Œæ— éœ€é¢å¤–è¯·æ±‚ | ä½“ç§¯å¢å¤§33%ï¼Œä¸é€‚åˆå¤§æ–‡ä»¶ |
| **FileReader** | è¯»å–æ–‡ä»¶å†…å®¹    | å¤šç§è¯»å–æ–¹å¼     | å¼‚æ­¥æ“ä½œï¼Œéœ€è¦å›è°ƒ      |

# MIME
---

**MIME ç±»å‹**ï¼ˆä¹Ÿç§°ä¸º**åª’ä½“ç±»å‹**æˆ–**å†…å®¹ç±»å‹**ï¼‰æ˜¯ä¸€ç§æ ‡å‡†ï¼Œç”¨æ¥è¡¨ç¤ºæ–‡æ¡£ã€æ–‡ä»¶æˆ–å­—èŠ‚æµçš„**æ€§è´¨å’Œæ ¼å¼**ã€‚
å®ƒçš„å…¨ç§°æ˜¯Â **Multipurpose Internet Mail Extensions**ï¼ˆå¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ï¼‰ã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒæœ€åˆæ˜¯ä¸ºäº†åœ¨ç”µå­é‚®ä»¶ä¸­æ”¯æŒé ASCII å­—ç¬¦å’Œé™„ä»¶è€Œè®¾è®¡çš„ï¼Œä½†ç°åœ¨å®ƒè¢«å¹¿æ³›åº”ç”¨åœ¨äº’è”ç½‘çš„å„ä¸ªé¢†åŸŸï¼Œå°¤å…¶æ˜¯ HTTP åè®®ä¸­ã€‚

**MIME ç±»å‹å°±æ˜¯ç­”æ¡ˆã€‚**Â æœåŠ¡å™¨åœ¨å‘é€æ•°æ®ä¹‹å‰ï¼Œä¼šåœ¨ HTTP å“åº”çš„å¤´éƒ¨ï¼ˆHeadersï¼‰ä¸­åŒ…å«ä¸€ä¸ªÂ `Content-Type`Â å­—æ®µï¼Œå‘Šè¯‰æµè§ˆå™¨ï¼ˆæˆ–å…¶ä»–å®¢æˆ·ç«¯ï¼‰æ­£åœ¨å‘é€çš„æ•°æ®æ˜¯ä»€ä¹ˆç±»å‹ã€‚

Content-Type: text/html; charset=UTF-8
è¿™è¡Œä»£ç å‘Šè¯‰æµè§ˆå™¨ï¼šâ€œæ¥ä¸‹æ¥è¦å‘é€çš„å†…å®¹æ˜¯ HTML æ–‡æœ¬ï¼Œä½¿ç”¨çš„å­—ç¬¦ç¼–ç æ˜¯ UTF-8â€ã€‚æµè§ˆå™¨æ”¶åˆ°è¿™ä¸ªä¿¡å·åï¼Œå°±ä¼šå¯åŠ¨ HTML è§£æå™¨æ¥æ¸²æŸ“é¡µé¢ã€‚
å¦‚æœæ²¡æœ‰ MIME ç±»å‹ï¼Œæµè§ˆå™¨åªèƒ½é çŒœæµ‹æ¥å¤„ç†æ•°æ®ï¼Œç»“æœä¼šéå¸¸ä¸å¯é å’Œå®‰å…¨ã€‚

MIME ç±»å‹ç”±**ç±»å‹ï¼ˆtypeï¼‰**Â å’Œ**å­ç±»å‹ï¼ˆsubtypeï¼‰**Â ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸­é—´ç”±ä¸€æ¡**æ­£æ–œæ Â `/`**Â è¿æ¥ã€‚
æ ¼å¼ï¼š`type/subtype`
##### 1. ç±»å‹ï¼ˆTypeï¼‰
ä»£è¡¨å¤§çš„ç±»åˆ«ï¼Œè¯´æ˜æ•°æ®çš„ä¸€èˆ¬ç±»å‹ã€‚å¸¸è§çš„é¡¶çº§ç±»å‹æœ‰ï¼š

- `text`ï¼š æ–‡æœ¬æ–‡ä»¶ï¼Œäººç±»å¯è¯»çš„æ–‡å­—å†…å®¹ã€‚
    - ä¾‹å¦‚ï¼š`text/plain`,Â `text/html`,Â `text/css`
        
- `image`ï¼š å›¾åƒæ–‡ä»¶æˆ–å›¾å½¢æ•°æ®ã€‚
    - ä¾‹å¦‚ï¼š`image/jpeg`,Â `image/png`,Â `image/gif`
        
- `audio`ï¼š éŸ³é¢‘æˆ–éŸ³ä¹æ•°æ®ã€‚
    - ä¾‹å¦‚ï¼š`audio/mpeg`,Â `audio/wav`
        
- `video`ï¼š è§†é¢‘æˆ–åŠ¨æ€å›¾åƒæ•°æ®ã€‚
    - ä¾‹å¦‚ï¼š`video/mp4`,Â `video/webm`
        
- `application`ï¼š äºŒè¿›åˆ¶æ•°æ®æˆ–ä¸å±äºå…¶ä»–ç±»åˆ«çš„æ•°æ®ã€‚é€šå¸¸æ˜¯éœ€è¦ç”±åº”ç”¨ç¨‹åºå¤„ç†çš„æ–‡ä»¶ã€‚
    - ä¾‹å¦‚ï¼š`application/pdf`,Â `application/json`,Â `application/javascript`
        
- `multipart`ï¼š ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆçš„æ•°æ®ï¼Œæ¯ä¸ªéƒ¨åˆ†å¯ä»¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ç±»å‹ã€‚å¸¸ç”¨äºç”µå­é‚®ä»¶æˆ–è¡¨å•æäº¤ã€‚
    - ä¾‹å¦‚ï¼š`multipart/form-data`
        
- `font`ï¼š å­—ä½“æ–‡ä»¶ã€‚
    - ä¾‹å¦‚ï¼š`font/woff2`,Â `font/ttf`

##### 2. å­ç±»å‹ï¼ˆSubtypeï¼‰
ä»£è¡¨ç‰¹å®šç±»å‹ä¸­çš„å…·ä½“æ ¼å¼ã€‚å®ƒç²¾ç¡®åœ°æŒ‡å®šäº†æ˜¯å“ªç§Â `text`Â æˆ–å“ªç§Â `image`ã€‚
ä¾‹å¦‚ï¼ŒåŒæ˜¯Â `text`Â ç±»å‹ï¼Œ`text/plain`Â æ˜¯çº¯æ–‡æœ¬ï¼Œè€ŒÂ `text/html`Â æ˜¯ HTML æ–‡æ¡£ã€‚
##### å¸¸è§ MIME ç±»å‹ç¤ºä¾‹

|æ–‡ä»¶æ ¼å¼|MIME ç±»å‹|è¯´æ˜|
|---|---|---|
|`.html`|`text/html`|HTML æ–‡æ¡£|
|`.css`|`text/css`|CSS æ ·å¼è¡¨|
|`.js`|`application/javascript`|JavaScript æ–‡ä»¶|
|`.json`|`application/json`|JSON æ•°æ®|
|`.png`|`image/png`|PNG å›¾åƒ|
|`.jpg`Â /Â `.jpeg`|`image/jpeg`|JPEG å›¾åƒ|
|`.pdf`|`application/pdf`|Adobe PDF æ–‡æ¡£|
|`.zip`|`application/zip`|ZIP å‹ç¼©æ¡£æ¡ˆ|
|`.mp3`|`audio/mpeg`|MP3 éŸ³é¢‘|
|`.mp4`|`video/mp4`|MP4 è§†é¢‘|

##### é‡è¦å‚æ•°ï¼š`charset`

å¯¹äºä¸€äº›æ–‡æœ¬ç±»å‹çš„æ–‡ä»¶ï¼Œç»å¸¸éœ€è¦æŒ‡å®šä¸€ä¸ªé‡è¦çš„å‚æ•°â€”â€”**å­—ç¬¦ç¼–ç ï¼ˆcharacter setï¼‰**ã€‚è¿™ç”¨Â `charset`Â æ¥è¡¨ç¤ºï¼Œä¸ä¸»ç±»å‹ç”¨åˆ†å·Â `;`Â åˆ†éš”ã€‚
- **ç¤ºä¾‹ï¼š**Â `text/html; charset=UTF-8`
- **ä½œç”¨ï¼š**Â å‘Šè¯‰æµè§ˆå™¨åº”è¯¥ä½¿ç”¨å“ªç§å­—ç¬¦ç¼–ç æ¥è§£è¯»æ–‡æœ¬ï¼Œé˜²æ­¢å‡ºç°ä¹±ç ã€‚å¯¹äºç°ä»£ Web å¼€å‘ï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯Â `UTF-8`ã€‚
##### åœ¨å®é™…ä¸­çš„åº”ç”¨
1. **HTTP åè®®**ï¼š å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨ HTTP è¯·æ±‚å’Œå“åº”çš„å¤´éƒ¨ä¸­ï¼Œ`Content-Type`Â å­—æ®µè‡³å…³é‡è¦ã€‚
2. **ç”µå­é‚®ä»¶**ï¼š ç”¨äºæ ‡è¯†é‚®ä»¶æ­£æ–‡å’Œé™„ä»¶çš„æ ¼å¼ã€‚
3. **æ–‡ä»¶ç³»ç»Ÿ**ï¼š æŸäº›æ“ä½œç³»ç»Ÿä¼šç”¨ MIME ç±»å‹æ¥å…³è”æ‰“å¼€æ–‡ä»¶çš„é»˜è®¤åº”ç”¨ç¨‹åºã€‚
4. **`<link>`Â å’ŒÂ `<script>`Â æ ‡ç­¾**ï¼š åœ¨ HTML ä¸­ï¼Œä½ å¯ä»¥æŒ‡å®šå¼•å…¥èµ„æºçš„ç±»å‹ã€‚
    <link rel="stylesheet" type="text/css" href="theme.css">
    <script type="application/javascript" src="app.js"></script>
    ï¼ˆæ³¨æ„ï¼šåœ¨ç°ä»£ HTML5 ä¸­ï¼Œ`type`Â å±æ€§å¯¹äº CSS å’Œ JavaScript é€šå¸¸å¯ä»¥çœç•¥ï¼Œå› ä¸ºå®ƒä»¬å·²æ˜¯é»˜è®¤å€¼ã€‚ï¼‰